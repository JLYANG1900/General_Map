<div class="general-wrapper">
    <h1>大地图 - 自由定义一切</h1>
    
    <!-- 顶部控制栏 -->
    <div class="controls-bar">
        <!-- V3新增：返回上一层按钮 (默认隐藏) -->
        <button id="map-back-btn" class="general-btn danger" style="display:none;" onclick="window.GeneralMap.goBackMap()">⬅️ 返回上一层</button>

        <!-- 编辑开关 -->
        <div class="edit-toggle-wrapper">
            <label class="switch">
                <input type="checkbox" id="edit-mode-toggle" onchange="window.GeneralMap.toggleEditMode()">
                <span class="slider round"></span>
            </label>
            <span id="edit-mode-label">✏️ 编辑模式</span>
        </div>

        <!-- 新增：添加地点按钮 -->
        <button class="general-btn" onclick="window.GeneralMap.addNewPin()">📍 新增地点</button>

        <!-- 数据重置 -->
        <button class="general-btn" onclick="window.GeneralMap.resetData()">↺ 重置数据</button>
        
        <!-- [新增] 备份功能 -->
        <button class="general-btn" onclick="window.GeneralMap.exportBackup()">💾 导出备份</button>
        <button class="general-btn" onclick="document.getElementById('backup-upload').click()">📥 导入备份</button>
        <input type="file" id="backup-upload" style="display:none" accept=".json" onchange="window.GeneralMap.importBackup(this)">

        <!-- 背景更换 (已移动至下方) -->
        <input type="file" id="bg-upload" accept="image/*" style="display:none;" onchange="window.GeneralMap.changeBackground(this)">

        <!-- 新增：主题颜色选择器 -->
        <div style="display: flex; align-items: center; gap: 5px; margin-left: 5px;">
            <span>🎨 主题色:</span>
            <input type="color" id="theme-color-picker" value="#b38b59" onchange="window.GeneralMap.applyTheme(this.value)" style="border:none; padding:0; background:none; cursor:pointer;">
        </div>
    </div>

    <!-- 副标题区域：包含背景更换按钮和当前区域信息 -->
    <h2 style="display:flex; align-items:center; justify-content:center; gap:10px;">
        <button class="general-btn small" onclick="document.getElementById('bg-upload').click()">📂 更换背景...</button>
        <span id="subtitle-text">双击地标查看详情，长按拖拽移动 (编辑模式下可直接拖拽)</span>
    </h2>

    <!-- 地图容器：内容由 JS 动态生成 -->
    <div class="map-container" id="general-map-container">
        <!-- 动态生成的 Pins 会放在这里 -->
    </div>

    <!-- 通用弹窗容器：内容由 JS 动态生成 -->
    <div id="dynamic-popup" class="general-popup">
        <span class="close-btn" onclick="window.GeneralMap.closeAllPopups()">&times;</span>
        <div id="popup-content"></div>
    </div>

    <!-- 遮罩层 -->
    <div class="popup-overlay" id="general-overlay" onclick="window.GeneralMap.closeAllPopups()"></div>

    <!-- 出行菜单 -->
    <div id="travel-menu-overlay" onclick="if(event.target === this) window.GeneralMap.closeTravelMenu()">
        <div class="travel-menu-box">
            <span class="close-btn" onclick="window.GeneralMap.closeTravelMenu()">&times;</span>
            <div id="travel-title" style="color:var(--theme-color); margin-bottom:20px;">前往目的地</div>
            <div id="travel-content" class="travel-options"></div>
        </div>
    </div>
</div>
